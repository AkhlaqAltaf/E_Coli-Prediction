{% extends 'website/base.html' %}

{% block content %}
<div class="jumbotron text-center bg-white">
    <h1 class="display-4">Welcome to E. coli Prediction System</h1>
    <p class="lead">Real-time E. coli contamination forecasting for different creeks.</p>
    <hr class="my-4">
    <p>Select a creek from the dropdown menu in the navbar to view the latest E. coli predictions.</p>
    <a class="btn btn-primary btn-lg" href="#" role="button">Learn more</a>
</div>

<div class="container">
    <div class="row">
        <div class="col-md-8">
            <h2>Current Forecasting For Your Current Location</h2>

            <div class="form-group">
                <label for="location-dropdown" style="display:None">Select Location:</label>
                <select class="form-control" id="location-dropdown" style="display:None">
                    <option value="39.73567,-86.19647" selected>Current Location</option>
                </select>
            </div>
   <div class="chart-container" style="position: relative; height:40vh; width:80vw">
            <canvas id="weather-chart"></canvas>
        </div>
        </div>

        <div >
            <h2>About Our System</h2>
            <p>Our E. coli prediction system uses advanced machine learning algorithms to forecast contamination levels in various creeks. By analyzing historical data and environmental factors, we provide accurate and reliable predictions to help you stay safe and informed.</p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <h2>How to Use the System</h2>
            <p>Follow these simple steps to use our E. coli prediction system:</p>
            <ol>
                <li>Navigate to the top navbar and hover over "Select Creek" to see the dropdown menu.</li>
                <li>Choose your desired creek from the dropdown menu.</li>
                <li>View the current E. coli contamination predictions and take necessary precautions.</li>
                <li>Check back regularly for updated predictions and stay informed about water quality in your area.</li>
            </ol>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(fetchWeatherData);
        } else {
            alert("Geolocation is not supported by this browser.");
        }
    });

    function fetchWeatherData(position) {
        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;

        document.getElementById("loader").style.display = "block";
        document.getElementById("weather-data").style.display = "none";

        fetch(`/weather-data?lat=${latitude}&lon=${longitude}`)
            .then(response => response.json())
            .then(data => {
                document.getElementById("temp").textContent = data.temp;
                document.getElementById("precp").textContent = data.precp;
                document.getElementById("rain").textContent = data.rain;
                document.getElementById("loader").style.display = "none";
                document.getElementById("weather-data").style.display = "block";

                // Update the dropdown menu with the current location
                const locationDropdown = document.getElementById("location-dropdown");
                const option = document.createElement("option");
                option.value = `${latitude},${longitude}`;
                option.textContent = `Your Location (${latitude.toFixed(2)}, ${longitude.toFixed(2)})`;
                locationDropdown.appendChild(option);

                // Reload the page to reflect the changes
                location.reload();
            })
            .catch(error => {
                console.error('Error fetching weather data:', error);
                document.getElementById("loader").textContent = "Error loading data.";
            });
    }
</script>
{% endblock %}
