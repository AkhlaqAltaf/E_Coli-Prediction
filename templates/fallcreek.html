{% extends 'website/base.html' %}

{% block content %}
    <div class="container mt-5">
        <h1 class="mb-4">Fall Creek Next 7 Day E Coli Alert</h1>
        <div class="form-group">
            <label for="location-dropdown">Select Location:</label>
            <select class="form-control" id="location-dropdown">
                <option value="39.8355,-86.1182">Fall Creek @ Keystone Ave</option>
                <option value="39.810472,-86.14214">Fall Creek @ 30th St</option>
                <option value="39.805583,-86.1496">Fall Creek @ Central Ave</option>
                <option value="39.8025,-86.159">Fall Creek @ Illinois St</option>
                <option value="39.797167,-86.16942">Fall Creek @ MLK</option>
                <option value="39.781778,-86.17683">Fall Creek @ Indiana Ave</option>
                <option value="39.84472,-86.0679">Devon Creek @ Radnor Rd</option>
                <option value="39.838768,-86.093856">Devon Creek @ Brown Rd</option>
                <option value="39.841028,-86.100944">Devon Creek @ Millersville Rd</option>

            </select>
        </div>
        <table class="table table-striped" id="weather-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Today's Avg Temp (°C)</th>
                    <th>15-Day Avg Temp (°C)</th>
                    <th>10-Day Avg Temp (°C)</th>
                    <th>10-Day Rain Sum (mm)</th>
                    <th>Precipitation (mm)</th>

                    <th>E-Coli Alert </th>
                </tr>
            </thead>
            <tbody>
                <!-- Data will be populated here via AJAX -->
            </tbody>
        </table>
    </div>
{% endblock %}

{% block scripts %}
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        $(document).ready(function() {
            function fetchWeatherData(lat, lon) {
                $.ajax({
                    url: '/weather-data',
                    data: {
                        lat: lat,
                        lon: lon,
                        creek:"fallcreek"
                    },
                    success: function(data) {
                        let tableBody = $('#weather-table tbody');
                        tableBody.empty();

                        data.forEach(function(row) {
                            tableBody.append(
                                `<tr>
                                    <td>${row.date}</td>
                                    <td>${row.today_avg_temp.toFixed(2)}</td>
                                    <td>${row['15_day_avg_temp'].toFixed(2)}</td>
                                    <td>${row['10_day_avg_temp'].toFixed(2)}</td>
                                    <td>${row['10_day_rain_sum'].toFixed(2)}</td>
                                    <td>${row.today_precipitation.toFixed(2)}</td>
                                    <td>${row.e_coli}</td>

                                </tr>`
                            );
                        });
                    },
                    error: function() {
                        alert('Failed to fetch weather data');
                    }
                });
            }

            // Default location coordinates
            let defaultLat = '52.52';
            let defaultLon = '13.41';

            // Fetch data for the default location on page load
            fetchWeatherData(defaultLat, defaultLon);

            $('#location-dropdown').change(function() {
                let selectedLocation = $(this).val();
                let coords = selectedLocation.split(',');

                fetchWeatherData(coords[0], coords[1]);
            });
        });
    </script>
{% endblock %}
